# 🔑 Google Places API 키 로테이션 완전 가이드

## 📋 **개요**
Google Places API의 일일 할당량 제한을 극복하기 위한 다중 API 키 로테이션 시스템입니다.

## 🎯 **문제점과 해결책**

### **현재 문제**
- Google Places API 무료 할당량: 약 1일 200-300건 정도
- 3개 지역 크롤링 시 부족 (제주 109개 + 서울 158개 + 부산 118개 = 385개)
- 403 에러 발생 시 크롤링 중단

### **해결책**
- 여러 Google 계정으로 API 키 생성
- 403 에러 발생 시 자동으로 다음 API 키로 교체
- 최대 3개 키까지 지원으로 총 900건 처리 가능

## 🔧 **설정 방법**

### **단계 1: 추가 Google 계정 생성**

#### **기존 계정 찾기**
1. `accounts.google.com/signin/usernamerecovery` 접속
2. 전화번호 입력하여 연결된 계정 확인
3. 브라우저의 Google 계정 관리에서 확인

#### **새 계정 생성** (필요시)
```
account1@gmail.com (기존)
account2@gmail.com (신규)
account3@gmail.com (신규)
```

### **단계 2: Google Cloud 프로젝트 생성**

각 계정마다 별도 프로젝트 생성:

1. **Google Cloud Console** (console.cloud.google.com) 접속
2. **새 프로젝트 생성**:
   ```
   honbab-nono-1 (기존)
   honbab-nono-2 (신규)
   honbab-nono-3 (신규)
   ```
3. **Places API 활성화**:
   - API 및 서비스 > 라이브러리
   - "Places API" 검색 후 사용 설정

### **단계 3: API 키 생성**

각 프로젝트에서:

1. **사용자 인증 정보** 메뉴 선택
2. **+ 사용자 인증 정보 만들기** > API 키
3. **API 키 제한 설정**:
   - 애플리케이션 제한사항: IP 주소 (크롤링 서버 IP)
   - API 제한사항: Places API만 선택
4. **키 복사 및 저장**

### **단계 4: 환경변수 설정**

`.env` 파일에 추가:

```bash
# Google Places API 인증 정보 (로테이션 지원)
GOOGLE_PLACES_API_KEY=YOUR_FIRST_API_KEY
GOOGLE_PLACES_API_KEY_2=YOUR_SECOND_API_KEY
GOOGLE_PLACES_API_KEY_3=YOUR_THIRD_API_KEY
```

## 🚀 **사용법**

### **자동 로테이션**
크롤러 실행 시 자동으로 작동:

```bash
node ultimate_restaurant_crawler.js
```

### **출력 예시**
```
🔑 Google Places API 키 3개 로드됨
⚠️ Google Places API 할당량 초과 (키 1/3)
🔄 Google API 키 교체: 2/3
✅ 새 API 키로 재시도 가능
🔄 API 키 교체 후 재시도 중... (1회차)
```

## 📊 **할당량 계산**

### **예상 사용량**
- **1키당 일일 한도**: 약 200-300건
- **3키 총 한도**: 약 600-900건
- **현재 필요량**: 385개 식당
- **여유분**: 215-515건

### **권장 전략**
1. **1키**: 제주도 (109개) - 충분
2. **2키**: 서울 (158개) - 충분  
3. **3키**: 부산 (118개) - 충분

## ⚠️ **주의사항**

### **Google Cloud 정책**
- 각 계정마다 월 $300 무료 크레딧 제공
- Places API는 월 $200까지 무료
- 무료 한도 초과 시 자동 과금됨

### **보안 고려사항**
- API 키는 IP 제한 설정 필수
- 코드에 직접 하드코딩 금지
- 환경변수 파일은 .gitignore에 추가

### **사용량 모니터링**
- Google Cloud Console > API 및 서비스 > 할당량
- 일일 사용량 확인 및 알림 설정 권장

## 🔄 **로테이션 로직**

### **작동 원리**
1. 첫 번째 키로 API 호출 시작
2. 403 에러 (할당량 초과) 발생 시 감지
3. 다음 키로 자동 교체
4. 1초 대기 후 재시도
5. 모든 키 소진 시 에러 종료

### **에러 처리**
- `OVER_QUERY_LIMIT` 메시지 감지
- HTTP 403 상태 코드 감지
- 재시도 횟수 제한 (키 개수만큼)

## 📈 **효과**

### **Before (1키)**
- 할당량 소진 시 작업 중단
- 다음날까지 대기 필요
- 크롤링 실패

### **After (3키)**
- 자동 키 교체로 지속 작업
- 3배 처리 용량 확보
- 안정적인 크롤링 완료

## 🎉 **완료 체크리스트**

- [ ] 추가 Google 계정 생성 (2개)
- [ ] Google Cloud 프로젝트 생성 (2개)  
- [ ] Places API 활성화 (2개 프로젝트)
- [ ] API 키 생성 및 제한 설정 (2개)
- [ ] .env 파일에 키 추가
- [ ] 크롤러 테스트 실행
- [ ] 로테이션 로직 동작 확인

이제 API 키 로테이션 시스템이 완성되었습니다! 새 API 키를 생성하면 바로 3개 지역 크롤링이 가능해집니다. 🚀